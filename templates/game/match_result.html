{% extends 'base.html' %}
{% load static %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'game/playing.css' %}"> 
   
{% endblock %}

{% block content %}
<div class="result-container">
    
    <div class="vs-title">
        {{ match.attacker.username }} vs {{ match.defender.username }}
    </div>

    <div class="status-badge">
        {% if match.status == "PENDING" %}
            â³ ì§„í–‰ ì¤‘
        {% elif match.status == "FINISHED" %}
            ğŸ ê²Œì„ ì¢…ë£Œ
        {% else %}
            âŒ ì·¨ì†Œë¨
        {% endif %}
    </div>

    {% if match.status == "PENDING" %}
        
        {% if user == match.attacker %}
            <div class="info-text">
                <h3 style="margin-bottom: 10px;">ìˆ˜ë½ ëŒ€ê¸° ì¤‘</h3>
                <p style="margin-bottom: 5px;">ë‚¸ ì¹´ë“œ: <strong>{{ match.attacker_card }}</strong></p>
                <p style="font-size: 0.9rem; color: #aaa;">
                    ({% if match.rule == "HIGH_WINS" %}ë†’ì€ ìˆ«ì ìŠ¹ë¦¬{% else %}ë‚®ì€ ìˆ«ì ìŠ¹ë¦¬{% endif %})
                </p>
            </div>
            
            <form action="{% url 'game:cancel' match.id %}" method="POST" style="margin-top: 20px;">
                {% csrf_token %}
                <button type="submit" class="btn" style="background: #dc3545; padding: 8px 16px; font-size: 0.9rem;">ê²Œì„ ì·¨ì†Œ</button>
            </form>

        {% elif user == match.defender %}
            <div class="info-text">
                <h3 style="margin: 0 0 10px 0;">ë„ì „ì¥ì´ ì™”ìŠµë‹ˆë‹¤!</h3>
                <p>ìƒëŒ€ê°€ ê³µê²©í–ˆìŠµë‹ˆë‹¤.</p>
            </div>
            
            <a href="{% url 'game:counter_start' match_id=match.id %}" class="btn btn-counter">
                ğŸ›¡ï¸ ë°˜ê²©í•˜ëŸ¬ ê°€ê¸°
            </a>
        {% endif %}

    {% elif match.status == "FINISHED" %}
        
        <div class="result-box">
            <h2>
                {% if match.result == "DRAW" %}
                    ğŸ¤ ë¬´ìŠ¹ë¶€!
                {% elif match.result == "ATTACKER_WIN" %}
                    ğŸ† {{ match.attacker.username }} ìŠ¹ë¦¬!
                {% else %}
                    ğŸ† {{ match.defender.username }} ìŠ¹ë¦¬!
                {% endif %}
            </h2>

            <div style="display: flex; justify-content: center; align-items: center; margin: 10px 0 20px 0;">
                
                <div>
                    <p style="font-size: 0.9rem;">{{ match.attacker.username }}</p>
                    <div class="card-box">{{ match.attacker_card }}</div>
                    <p class="delta-score" style="color: {% if match.result == 'ATTACKER_WIN' %}#4cd137{% elif match.result == 'DRAW' %}#ddd{% else %}#e84118{% endif %};">
                        {% if match.result == "ATTACKER_WIN" %}+{{ match.attacker_delta }}{% else %}{{ match.attacker_delta }}{% endif %}
                    </p>
                </div>

                <div class="vs-middle">VS</div>

                <div>
                    <p style="font-size: 0.9rem;">{{ match.defender.username }}</p>
                    <div class="card-box">{{ match.defender_card }}</div>
                    <p class="delta-score" style="color: {% if match.result == 'DEFENDER_WIN' %}#4cd137{% elif match.result == 'DRAW' %}#ddd{% else %}#e84118{% endif %};">
                        {% if match.result == "DEFENDER_WIN" %}+{{ match.defender_delta }}{% else %}{{ match.defender_delta }}{% endif %}
                    </p>
                </div>
            </div>

            <a href="{% url 'game:list' %}" class="btn-list">ëª©ë¡ìœ¼ë¡œ</a>
        </div>

    {% endif %}

</div>
{% endblock %}