{% extends 'base.html' %}
{% load static %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'game/playing.css' %}"> 
    <style>
        .result-container {
            max-width: 500px;      /* ë„ˆë¹„ë„ ì‚´ì§ ì¤„ì—¬ì„œ ëª¨ë°”ì¼ ì¹œí™”ì ìœ¼ë¡œ */
            margin: 30px auto;     /* ìœ„ìª½ ì—¬ë°± ì¤„ì„ (50px -> 30px) */
            text-align: center;
            color: #fff;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            /* ë†’ì´ ì œí•œ í•´ì œ (ë‚´ìš©ë¬¼ì´ ì‘ì•„ì ¸ì„œ ìŠ¤í¬ë¡¤ ë¶ˆí•„ìš”) */
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .vs-title { 
            font-size: 1.5rem;     /* í°íŠ¸ ì‚¬ì´ì¦ˆ ì¤„ì„ */
            margin-bottom: 10px;   /* ì—¬ë°± ì¤„ì„ (20px -> 10px) */
            font-weight: bold; 
            color: #ccc;           /* ìƒ‰ìƒì„ ì‚´ì§ ì—°í•˜ê²Œ */
        }

        .status-badge {
            display: inline-block;
            padding: 8px 18px; /* í¬ê¸° ì‚´ì§ ì¡°ì • */
            font-size: 0.95rem;
            border-radius: 30px; /* ë” ë‘¥ê¸€ê²Œ */
            margin-bottom: 20px;
            font-weight: bold;
            /* ê¸°ë³¸ ë°°ê²½ (PENDINGìš©) */
            /* background: #6f42c1; */
            box-shadow: 0 4px 10px rgba(0,0,0,0.3); /* ê·¸ë¦¼ì ì¶”ê°€ */
        }

        /* ê²Œì„ ì¢…ë£Œ ìƒíƒœ ë°°ì§€ ìŠ¤íƒ€ì¼ (ì¶”ê°€ë¨) */
        .status-badge.finished {
            background: linear-gradient(135deg, #2e7d32, #1b5e20);
            box-shadow: 0 4px 10px rgba(0,0,0,0.4);
        }


        /* [í•µì‹¬] ìŠ¹ë¦¬ ë¬¸êµ¬ (h2) ì—¬ë°± ì œì–´ */
        .result-box h2 {
            margin: 5px 0 15px 0;  /* ìœ„ 5px, ì•„ë˜ 15pxë¡œ í™• ì¤„ì„ */
            font-size: 1.8rem;     /* ë„ˆë¬´ í¬ì§€ ì•Šê²Œ ì¡°ì ˆ */
            line-height: 1.2;
        }

        .card-box {
            font-size: 3rem;       /* ìˆ«ì í¬ê¸° ì ë‹¹íˆ */
            font-weight: bold;
            color: #ffd700;
            margin: 10px 0;        /* ì¹´ë“œ ìœ„ì•„ë˜ ì—¬ë°± ì¶•ì†Œ */
            text-shadow: 0 4px 10px rgba(0,0,0,0.5);
        }

        /* ì ìˆ˜ í‘œê¸° (+10, -1 ë“±) */
        .delta-score {
            font-size: 1.1rem;
            font-weight: bold;
        }
        
        /* VS ê¸€ì */
        .vs-middle {
            align-self: center; 
            font-size: 1.5rem; 
            margin: 0 10px; 
            color: #888;
        }

        .btn-list {
            display: inline-block;
            padding: 12px 25px;
            background: #3a4b3c; /* ì„¸ë ¨ëœ ì–´ë‘ìš´ íšŒë¡ìƒ‰ */
            color: #fff;
            text-decoration: none;
            border-radius: 8px;
            font-weight: bold;
            margin-top: 25px;
            box-shadow: 0 6px 15px rgba(0,0,0,0.4); /* ë¶€ë“œëŸ¬ìš´ ê·¸ë¦¼ì */
            transition: all 0.3s ease; /* ë¶€ë“œëŸ¬ìš´ ì „í™˜ íš¨ê³¼ */
        }

        .btn-list:hover {
            background: #4a5b4c; /* í˜¸ë²„ ì‹œ ì‚´ì§ ë°ê²Œ */
            transform: translateY(-2px); /* í˜¸ë²„ ì‹œ ì‚´ì§ ì˜¬ë¼ê° */
            box-shadow: 0 8px 20px rgba(0,0,0,0.5);
        }

        .btn-counter {
            /* background: #28a745; */
            text-decoration: none; /* ë°‘ì¤„ ì œê±° */
            display: inline-block;
            margin-top: 15px;
            color: white; /* ê¸€ììƒ‰ í°ìƒ‰ ê³ ì • */
        }
        .btn-counter:hover {
            color: white; /* í˜¸ë²„ ì‹œì—ë„ í°ìƒ‰ ìœ ì§€ */
        }

    </style>
{% endblock %}

{% block content %}
<div class="result-container">
    
    <div class="vs-title">
        {{ match.attacker.username }} vs {{ match.defender.username }}
    </div>

    <div class="status-badge">
        {% if match.status == "PENDING" %}
            â³ ì§„í–‰ ì¤‘
        {% elif match.status == "FINISHED" %}
            ğŸ ê²Œì„ ì¢…ë£Œ
        {% else %}
            âŒ ì·¨ì†Œë¨
        {% endif %}
    </div>

    {% if match.status == "PENDING" %}
        
        {% if user == match.attacker %}
            <div class="info-text">
                <h3 style="margin-bottom: 10px;">ìˆ˜ë½ ëŒ€ê¸° ì¤‘</h3>
                <p style="margin-bottom: 5px;">ë‚¸ ì¹´ë“œ: <strong>{{ match.attacker_card }}</strong></p>
                <p style="font-size: 0.9rem; color: #aaa;">
                    ({% if match.rule == "HIGH_WINS" %}ë†’ì€ ìˆ«ì ìŠ¹ë¦¬{% else %}ë‚®ì€ ìˆ«ì ìŠ¹ë¦¬{% endif %})
                </p>
            </div>
            
            <form action="{% url 'game:cancel' match.id %}" method="POST" style="margin-top: 20px;">
                {% csrf_token %}
                <button type="submit" class="btn" style="background: #dc3545; padding: 8px 16px; font-size: 0.9rem;">ê²Œì„ ì·¨ì†Œ</button>
            </form>

        {% elif user == match.defender %}
            <div class="info-text">
                <h3 style="margin: 0 0 10px 0;">ë„ì „ì¥ì´ ì™”ìŠµë‹ˆë‹¤!</h3>
                <p>ìƒëŒ€ê°€ ê³µê²©í–ˆìŠµë‹ˆë‹¤.</p>
            </div>
            
            <a href="{% url 'game:counter_start' match_id=match.id %}" class="btn btn-counter">
                ğŸ›¡ï¸ ë°˜ê²©í•˜ëŸ¬ ê°€ê¸°
            </a>
        {% endif %}

    {% elif match.status == "FINISHED" %}
        
        <div class="result-box">
            <h2>
                {% if match.result == "DRAW" %}
                    ğŸ¤ ë¬´ìŠ¹ë¶€!
                {% elif match.result == "ATTACKER_WIN" %}
                    ğŸ† {{ match.attacker.username }} ìŠ¹ë¦¬!
                {% else %}
                    ğŸ† {{ match.defender.username }} ìŠ¹ë¦¬!
                {% endif %}
            </h2>

            <div style="display: flex; justify-content: center; align-items: center; margin: 10px 0 20px 0;">
                
                <div>
                    <p style="font-size: 0.9rem;">{{ match.attacker.username }}</p>
                    <div class="card-box">{{ match.attacker_card }}</div>
                    <p class="delta-score" style="color: {% if match.result == 'ATTACKER_WIN' %}#4cd137{% elif match.result == 'DRAW' %}#ddd{% else %}#e84118{% endif %};">
                        {% if match.result == "ATTACKER_WIN" %}+{{ match.attacker_delta }}{% else %}{{ match.attacker_delta }}{% endif %}
                    </p>
                </div>

                <div class="vs-middle">VS</div>

                <div>
                    <p style="font-size: 0.9rem;">{{ match.defender.username }}</p>
                    <div class="card-box">{{ match.defender_card }}</div>
                    <p class="delta-score" style="color: {% if match.result == 'DEFENDER_WIN' %}#4cd137{% elif match.result == 'DRAW' %}#ddd{% else %}#e84118{% endif %};">
                        {% if match.result == "DEFENDER_WIN" %}+{{ match.defender_delta }}{% else %}{{ match.defender_delta }}{% endif %}
                    </p>
                </div>
            </div>

            <a href="{% url 'game:list' %}" class="btn-list">ëª©ë¡ìœ¼ë¡œ</a>
        </div>

    {% endif %}

</div>
{% endblock %}